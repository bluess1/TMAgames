<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geometry Dash - TMA Game</title>
    
    <!-- Game-specific styles -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- Preload scripts for faster loading -->
    <link rel="preload" href="physics.js" as="script">
    <link rel="preload" href="multiplayer.js" as="script">
    <link rel="preload" href="game.js" as="script">
    
    <!-- Mobile optimization -->
    <meta name="theme-color" content="#74b9ff">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
</head>
<body>
    <!-- Game Header -->
    <div id="game-header">
        <button id="home-btn" onclick="goHome()">
            üè† Home
        </button>
        <h2 id="game-title">Geometry Dash</h2>
        <div id="game-controls">
            <button id="pause-btn">‚è∏Ô∏è Pause</button>
            <button id="restart-btn">üîÑ Restart</button>
        </div>
    </div>
    
    <!-- Game Container -->
    <div id="game-container">
        <!-- Loading Screen -->
        <div id="loading-screen" style="display: flex;"> <!-- Initially visible -->
            <div class="loading-spinner"></div>
            <p>Loading Geometry Dash...</p>
        </div>
        
        <!-- Game Canvas -->
        <canvas id="gameCanvas"></canvas>
        
        <!-- Game UI Overlay -->
        <div id="game-ui">
            <div id="progress-container">
                <div id="progress-bar">
                    <div id="progress-fill"></div>
                </div>
                <span id="progress-text">0%</span>
            </div>
            
            <div id="multiplayer-info" style="display: none;">
                <span id="player-count">Players: 1</span>
                <span id="room-id">Room: </span>
            </div>
        </div>
        
        <!-- Game Over & Victory Screens (remain hidden) -->
        <div id="game-over-screen" style="display: none;"></div>
        <div id="victory-screen" style="display: none;"></div>
        
        <!-- Menu Screen (initially visible over the canvas) -->
        <div id="menu-screen" style="display: flex;">
            <div class="menu-content">
                <h1>Geometry Dash</h1>
                <p>Click or press SPACE to jump!</p>
                <div class="menu-buttons">
                    <!-- CORRECTED: Buttons now have IDs, no onclick -->
                    <button id="start-single-player-btn">üéÆ Single Player</button>
                    <button id="start-multiplayer-btn">üë• Multiplayer</button>
                </div>
                <div class="controls-info">
                    <p><strong>Controls:</strong> üñ±Ô∏è Click / ‚å®Ô∏è SPACE / üì± Tap</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Mobile Touch Controls (hidden by default) -->
    <div id="mobile-controls" style="display: none;">
        <button id="jump-btn">JUMP</button>
    </div>
    
    <!-- Scripts - CRITICAL: Load helper scripts BEFORE the main game script -->
    <script src="physics.js"></script>
    <script src="multiplayer.js"></script>
    <script src="game.js"></script>
    
    <!-- Game Initialization Script (The "Conductor") -->
    <script>
        console.log('üéÆ Game HTML loaded');
        console.log('PhysicsEngine available:', typeof PhysicsEngine);
        console.log('MultiplayerManager available:', typeof MultiplayerManager);
        console.log('GeometryDashGame available:', typeof GeometryDashGame);
        
        document.addEventListener('DOMContentLoaded', () => {
            console.log('‚úÖ DOM Content Loaded');
            
            let gameInstance;

            // This is now the ONLY place where the game instance is created.
            if (typeof GeometryDashGame !== 'undefined') {
                gameInstance = new GeometryDashGame();

                // Find buttons by their new IDs
                const singlePlayerBtn = document.getElementById('start-single-player-btn');
                const multiPlayerBtn = document.getElementById('start-multiplayer-btn');
                const pauseBtn = document.getElementById('pause-btn');
                const restartBtn = document.getElementById('restart-btn');

                // Attach click events using JavaScript
                if (singlePlayerBtn) {
                    singlePlayerBtn.addEventListener('click', () => {
                        gameInstance.startGame(false); // 'false' for single player
                    });
                }

                if (multiPlayerBtn) {
                    multiPlayerBtn.addEventListener('click', () => {
                        gameInstance.startGame(true); // 'true' for multiplayer
                    });
                }

                if (pauseBtn) {
                    pauseBtn.addEventListener('click', () => {
                        if (gameInstance) gameInstance.togglePause();
                    });
                }
                
                if (restartBtn) {
                    restartBtn.addEventListener('click', () => {
                        if (gameInstance) location.reload(); // Simple reload is often best for restart
                    });
                }

            } else {
                console.error('‚ùå GeometryDashGame class not found!');
                alert('Error: Game failed to load. Check console for details.');
            }
        });
        
        // Helper function for the Home button
        function goHome() {
            window.location.href = '../../index.html';
        };
    </script>
</body>
</html>
